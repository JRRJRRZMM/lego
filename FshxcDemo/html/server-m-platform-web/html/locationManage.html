<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type">

	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>定位系数</title>
	<link rel="stylesheet" href="../css/bootstrap.min.css" />
	<style>
		html {
			font-size: 50px;
		}
	</style>
</head>

<body style="background:#FCF9F2">
	<div class="container" style="width:14rem;">
		<div class="panel panel-default">
			<div class="panel-heading">定位系数</div>
			<div class="panel-body" style="width:10rem;margin:0 auto">
				<div class="form-group">
					<label for="exampleInputEmail1">建筑物Id</label>
					<p class="form-control-static">
						<span id="buildingId"></span> (
						<span id="buildingName"></span>)</p>
				</div>
				<div class="form-group">
					<label for="phoneModel">手机型号</label>
					<select type="text" class="form-control" id="phoneModel" placeholder="该功能暂为开放">
						<option value="">安卓</option>
						<option value="">苹果</option>
					</select>
				</div>
				<div class="form-group">
					<label for="stepLength">步态长度</label>
					<input type="text" class="form-control" id="stepLength" maxlength="3">
				</div>
				<div class="form-group">
					<label for="blePdrSwitch">几次Pdr计算后进行蓝牙定位纠偏</label>
					<input type="text" class="form-control" id="blePdrSwitch" maxlength="3">
				</div>
				<div class="form-group">
					<label for="staticRectification">几秒静止不动后进行蓝牙定位纠偏</label>
					<input type="text" class="form-control" id="staticRectification" maxlength="2">
				</div>
				<div class="form-group">
					<label for="rssiRange">rssi过滤范围</label>
					<input type="text" class="form-control" id="rssiRange" maxlength="10">
				</div>
				<div class="form-group">
					<label for="hollowArea">中空区域过滤</label>
					<select type="text" class="form-control" id="hollowArea">
						<option value="">YES</option>
						<option value="">No</option>
					</select>
				</div>
				<div class="form-group">
					<label for="particlesAmount">粒子滤波中的粒子数量</label>
					<input type="text" class="form-control" id="particlesAmount" maxlength="5">
				</div>

				<div class="form-group">
					<label for="beaconNum">定位中所必须使用的最少beacon个数</label>
					<input type="text" class="form-control" id="beaconNum" maxlength="5" placeholder="该功能暂为开放">
				</div>

				<div class="form-group">
					<button type="submit" id="submit" class="btn btn-default btn-block" style="font-size:20px;">提 交</button>
				</div>

			</div>
		</div>
	</div>

	<script src="../js/jquery-3.2.1.min.js"></script>
	<script src="../plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="../js/bin.js"></script>
	<script>
		var basePath = url();
		//拓展jquery 查url参数方法
		$.getUrlParam = function (name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
			var r = window.location.search.substr(1).match(reg);
			if (r != null) return unescape(r[2]);
			return null;
		}

		function Page() {}
		$.extend(Page.prototype, {
			init: function () {
				//加载事件
				this.events();
			},
			// 公有属性
			router: {
				buildingId: $.getUrlParam("buildingId"),
				buildingName: $.getUrlParam("buildingName"),
				url: basePath,//basePath
			},
			//加载事件
			events: function () {
				this.initForme();
				this.clickBandleSubmit();
			},
			initForme: function () {
				$("#buildingName").html(this.router.buildingName);
				$("#buildingId").html(this.router.buildingId);
				let myUrl =
					this.router.url +
					"LocatingSpecificParameter/selectLocatingSpecificParameter/" +
					this.router.buildingId +
					"?jsessionid=" +
					sessionStorage.getItem("jsessionid");
				$.ajax({
					type: "GET",
					dataType: "json",
					contentType: "application/json",
					url: myUrl,
					success: function (res) {
						var data = res.data;
						for (var key in data) {
							$("#" + key).val(data[key])
						}
					}
				});
			},
			clickBandleSubmit: function () {
				var _this = this;
				let myUrl =
					this.router.url +
					"LocatingSpecificParameter/updateLLocatingSpecificParameter/?jsessionid=" + sessionStorage.getItem("jsessionid");
				$("#submit").on("click", function () {
					$.ajax({
						type: "PUT",
						dataType: "json",
						data: JSON.stringify({
							"buildingId": _this.router.buildingId,
							"stepLength": $("#stepLength").val(),
							"blePdrSwitch": $("#blePdrSwitch").val(),
							"staticRectification": $("#staticRectification").val(),
							"rssiRange": $("#rssiRange").val(),
							"hollowArea": $("#hollowArea").val(),
							"particlesAmount": $("#particlesAmount").val()
						}),
						contentType: "application/json",
						url: myUrl,
						success: function (res) {
							alert("修改成功");
						}
					})
				})
			}
		})

		$(function () {
			var page = new Page();
			page.init();
		});
	</script>
</body>

</html>
